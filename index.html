<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catan Score Tracker</title>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Use system fonts to avoid Google Fonts errors */
    html, body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; height: 100%; margin: 0; }
    body { background: url('https://www.transparenttextures.com/patterns/wood-pattern.png'); background-color: #f3e8c7; }

    /* Panel styling */
    .panel { box-sizing: border-box; position: relative; backdrop-filter: blur(6px); border: 4px solid transparent; background:
      linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)) padding-box,
      linear-gradient(45deg,#d69e2e,#c05621) border-box; }

    /* Buttons (no @apply so it works without build step) */
    .counter-btn { background:#d69e2e; color:#fff; width:3rem; height:3rem; display:flex; align-items:center; justify-content:center; font-size:1.25rem; border-radius:9999px; box-shadow: 0 6px 16px rgba(0,0,0,.15); transition: transform .12s ease, background .15s ease; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    .counter-btn:hover { background:#c0841f; }
    .counter-btn:active { transform: scale(0.95); }

    .fs-btn { background:#2563eb; color:#fff; padding:.5rem 1rem; border-radius:.5rem; box-shadow: 0 6px 16px rgba(0,0,0,.12); transition: background .15s ease; }
    .fs-btn:hover { background:#1d4ed8; }

    .ghost-btn { color:#374151; padding:.5rem .75rem; border-radius:.5rem; }
    .ghost-btn:hover { background: rgba(0,0,0,.05); }

    .pill { padding:.25rem .75rem; border-radius:9999px; font-size:.875rem; cursor:pointer; user-select:none; transition: background .15s ease, color .15s ease, box-shadow .15s ease; }

    .swatch { width: 18px; height: 18px; border-radius: 9999px; border: 2px solid rgba(0,0,0,.2); box-shadow: 0 1px 1px rgba(0,0,0,.25) inset; }

    .toggle-on { background-color:#d69e2e !important; }

    /* Leader highlight (static, no animation) */
    .leader-tile { background: linear-gradient(180deg, rgba(255,250,205,0.98), rgba(255,255,240,0.96)); box-shadow: 0 12px 28px rgba(214,158,46,.35), 0 0 0 3px rgba(214,158,46,.45) inset; }
  </style>
  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="p-1 xl:p-3 h-full">
  <div id="root" class="max-w-screen-2xl mx-auto h-full px-1 lg:px-2"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef, useCallback } = React;

    // === Icons ==============================================================
    const Icon = ({ name, size = 18, className = '' }) => {
      const common = { width: size, height: size, viewBox: '0 0 24 24', className, 'aria-hidden': true };
      switch (name) {
        case 'road':
          return (<svg {...common}><rect x="3" y="10" width="18" height="4" rx="2" fill="#8B5A2B" stroke="#5F3B1A" strokeWidth="1" /><circle cx="6" cy="12" r="1" fill="#D6A77A"/><circle cx="12" cy="12" r="1" fill="#D6A77A"/><circle cx="18" cy="12" r="1" fill="#D6A77A"/></svg>);
        case 'anchor':
          return (<svg {...common}><path d="M12 3a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm1 5h-2v7.2a5.5 5.5 0 0 1-3.9-3.2l-1.7.8A7 7 0 0 0 11 18.7V21h2v-2.3a7 7 0 0 0 5.6-5.9l-1.7-.8a5.5 5.5 0 0 1-3.9 3.2V8Z" fill="#1F4D6B"/></svg>);
        case 'science':
          return (<svg {...common}><path d="M9 3h6l-2 5 4 6a4 4 0 0 1-3.3 6H8.3A4 4 0 0 1 5 14l4-6-2-5Z" fill="#1D9BF0" opacity=".15"/><path d="M10 3h4l-2 5 4 6H8l4-6-2-5Z" fill="#1D9BF0"/></svg>);
        case 'trade':
          return (<svg {...common}><path d="M12 4h2v4h-2V4Zm-6 7h6a3 3 0 0 1-6 0Zm12 0h6a3 3 0 0 1-6 0ZM6 20h12v-2H6v2Z" fill="#B7791F"/></svg>);
        case 'politics':
          return (<svg {...common}><path d="M4 10h16l-8-6-8 6v6H5v-6Z" fill="#4A5568"/></svg>);
        case 'merchant':
          return (<svg {...common}><path d="M8 5h8l-1 2H9L8 5Zm-1 4h10l1 2-3 7H7L5 11l2-2Z" fill="#8C6D1F"/><circle cx="12" cy="15" r="2.5" fill="#D4AF37" stroke="#7A5F14" strokeWidth="1"/></svg>);
        case 'cards':
          return (<svg {...common}><rect x="5" y="6" width="10" height="14" rx="2" fill="#C05621" opacity=".8"/><rect x="9" y="4" width="10" height="14" rx="2" fill="#E6B17A" stroke="#8C5A3C" strokeWidth="1"/></svg>);
        case 'coin':
          return (<svg {...common}><circle cx="12" cy="12" r="8" fill="#D4AF37" stroke="#8C6D1F" strokeWidth="2"/><circle cx="12" cy="12" r="4" fill="#F6E27A"/></svg>);
        case 'island':
          return (<svg {...common}><path d="M3 17h18v2H3v-2Z" fill="#2B6CB0"/><ellipse cx="12" cy="15" rx="6" ry="2" fill="#CFC07A"/><path d="M10 12c1-1 3-1 4 0l1 1H9l1-1Z" fill="#9CAD5A"/></svg>);
        case 'settlement':
          return (<svg {...common}><path d="M5 12 12 6l7 6v6H5v-6Z" fill="#C53030"/><rect x="9" y="14" width="6" height="4" fill="#F7FAFC"/></svg>);
        case 'city':
          return (<svg {...common}><path d="M7 20V12h4v8H7Zm6 0V8h4v12h-4Zm-6-9 2-2 2 2H7Z" fill="#2D3748"/></svg>);
        case 'crown':
          return (<svg {...common}><path d="M3 8l4 3 5-6 5 6 4-3v9H3V8z" fill="#D4AF37" stroke="#7A5F14" strokeWidth="1"/></svg>);
        default: return null;
      }
    };

    // === Constants & Defaults ==============================================
    const EXCLUSIVE_KEYS = ['metropolisScience','metropolisTrade','metropolisPolitics','merchant'];
    const TOGGLES_ALL = [
      ['metropolisScience', 'Science Metropolis', 2, 'science', (exp) => exp.ck],
      ['metropolisTrade', 'Trade Metropolis', 2, 'trade', (exp) => exp.ck],
      ['metropolisPolitics', 'Politics Metropolis', 2, 'politics', (exp) => exp.ck],
      ['merchant', 'Merchant', 1, 'merchant', (exp) => exp.ck]
    ];

    const DEFAULT_COLORS = ['#C53030', '#2B6CB0', '#CBD5E0', '#ED8936']; // red, blue, white, orange

    const DEFAULT_PLAYER = (idx=0) => ({
      name: '',
      color: DEFAULT_COLORS[idx % DEFAULT_COLORS.length],
      longestRoad:false,
      harborMaster:false,
      metropolisScience:false,
      metropolisTrade:false,
      metropolisPolitics:false,
      merchant:false,
      vpCards:0,
      gold:0,
      harbors:0,
      roads:0,
      islands:0,
      settlements:1,
      cities:1
    });

    // === Helpers ============================================================
    function computeGoldBonuses(players){
      const values = players.map(p=>p.gold);
      if(values.length===0) return [];
      const max = Math.max(...values);
      const min = Math.min(...values);
      const topCount = values.filter(v=>v===max).length;
      return players.map(p => (p.gold===max && topCount===1) ? 1 : (p.gold===min ? -2 : 0));
    }

    function usePressRepeat(action, options={ initialDelay: 300, repeatDelay: 120 }){
      const longTimer = React.useRef(null);
      const repeatTimer = React.useRef(null);
      const longFired = React.useRef(false);
      const pressed = React.useRef(false);
      const clear = ()=>{ if(longTimer.current){ clearTimeout(longTimer.current); longTimer.current=null; } if(repeatTimer.current){ clearInterval(repeatTimer.current); repeatTimer.current=null; } longFired.current=false; pressed.current=false; };
      const onPointerDown = (e)=>{ e.preventDefault(); pressed.current = true; longFired.current = false; longTimer.current = setTimeout(()=>{ if(!pressed.current) return; longFired.current = true; action(); repeatTimer.current = setInterval(action, options.repeatDelay); }, options.initialDelay); };
      const onPointerUp = ()=>{ if(!pressed.current){ clear(); return; } if(!longFired	current){ action(); } clear(); };
      const onPointerLeave = clear; const onPointerCancel = clear;
      React.useEffect(()=>clear,[]);
      return { onPointerDown, onPointerUp, onPointerLeave, onPointerCancel };
    }

    const cx = (...cls)=> cls.filter(Boolean).join(' ');

    // === UI Bits ============================================================
    const IconToggle = ({ icon, label, checked, onChange, points, size = 28, readOnly = false }) => (
      <button
        type="button"
        className={cx(
          'relative inline-flex items-center justify-center w-14 h-14 md:w-16 md:h-16 rounded-full border transition transform select-none',
          'bg-white/90 border-yellow-300 shadow hover:shadow-md hover:scale-105 active:scale-95',
          checked && 'bg-amber-100 border-amber-500 border-[3px] ring-4 ring-amber-400 ring-offset-2 ring-offset-amber-100 shadow-2xl'
        )}
        onClick={()=> readOnly ? null : onChange(!checked)}
        aria-pressed={checked} aria-disabled={readOnly}
        aria-label={`${label} toggle (${checked? 'on':'off'})`}
        title={`${label} (+${points})`}
      >
        <Icon name={icon} size={size} />
        <span className="absolute -top-1 -right-1 bg-amber-400 text-amber-950 text-[11px] font-bold rounded-full px-1.5 py-0.5 shadow">+{points}</span>
        <span className="sr-only">{label}</span>
      </button>
    );

    const Counter = ({ icon, label, value, onChange, compact, labelClassName }) => {
      const safe = Number.isFinite(value) ? value : 0;
      const dec = ()=> onChange(Math.max(0, safe-1));
      const inc = ()=> onChange(safe+1);
      const decHandlers = usePressRepeat(dec);
      const incHandlers = usePressRepeat(inc);
      return (
        <div className={cx('flex items-center justify-between bg-yellow-100 rounded-lg shadow-inner mb-2 select-none', compact? 'px-2 py-1':'px-3 py-2')}>
          <span className={cx('text-base truncate flex items-center', labelClassName || 'text-gray-800 font-medium')}>
            <Icon name={icon} className="mr-2" /> {label}
          </span>
          <div className="flex items-center gap-3">
            <button type="button" className="counter-btn" {...decHandlers} aria-label={`Decrease ${label}`}>‚Äì</button>
            <span className="w-10 text-center text-2xl font-extrabold text-gray-800">{safe}</span>
            <button type="button" className="counter-btn" {...incHandlers} aria-label={`Increase ${label}`}>+</button>
          </div>
        </div>
      );
    };

    function PlayerPanel({ player, goldBonus, expansions, onChange, mode='v1', isLeader=false, goldRank='mid', hasLongest=false, hasHarborMaster=false }){
      const toggles = useMemo(() => TOGGLES_ALL.filter(([, , , , show]) => show(expansions)), [expansions]);
      const score = useMemo(()=>{
        const base = toggles.reduce((s,[key,_,pts])=> s + (player[key]?pts:0), 0);
        return base + (hasLongest?2:0) + ((expansions.tb && hasHarborMaster)?2:0) + player.vpCards + (expansions.seafarers ? player.islands*2 : 0) + player.settlements + player.cities*2 + (expansions.tb ? goldBonus : 0);
      }, [player, goldBonus, toggles, expansions, hasLongest, hasHarborMaster]);

      const accent = player.color || '#c05621';
      const baseStyle = mode==='v3' ? { borderImage: `linear-gradient(45deg, #d69e2e, ${accent}) 1` } : {};
      const panelStyle = isLeader ? { ...baseStyle, background: 'linear-gradient(180deg, rgba(255,250,205,0.98), rgba(255,255,240,0.96))' } : baseStyle;
      const compact = mode==='v2';

      const metros = toggles.filter(([key])=> key.startsWith('metropolis'));
      const others = toggles.filter(([key])=> !key.startsWith('metropolis'));

      return (
        <section className={cx('panel rounded-2xl shadow-lg flex flex-col', compact? 'px-3 pt-2 pb-1':'px-4 pt-3 pb-2', isLeader && 'ring-4 ring-amber-400 shadow-amber-300/50 shadow-xl leader-tile')} style={panelStyle}>
          <div className="mb-2">
            <div className="flex items-center gap-2">
              <input className={cx('w-full border-b-2 border-yellow-500 pb-1 px-1 font-semibold text-gray-800 focus:outline-none focus:border-red-500', compact? 'text-base':'text-lg')} placeholder="Player Name" value={player.name} onChange={e=>onChange('name', e.target.value)} />
              {mode==='v3' && (
                <div className="flex items-center gap-1" title="Player color">
                  {['#C53030','#2B6CB0','#CBD5E0','#ED8936'].map(c=> (
                    <button key={c} onClick={()=>onChange('color', c)} className="swatch" style={{ backgroundColor: c, outline: player.color===c? '2px solid black':'none' }} aria-label={`Set color ${c}`} />
                  ))}
                </div>
              )}
              {isLeader && (
                <span className="ml-1 bg-amber-400/90 text-amber-950 text-xs font-bold rounded-full px-2 py-0.5 flex items-center gap-1 shadow" title="Current leader">
                  <Icon name="crown" size={14} /> Leader
                </span>
              )}
            </div>
            <div className={cx('text-center font-extrabold text-red-900 leading-none', compact? 'text-3xl mt-1 mb-3':'text-4xl mt-1 mb-3')}>
              üèÜ {score} Points
            </div>
          </div>

          <div className="mt-2 mb-2 flex flex-wrap justify-center gap-3 md:gap-4" role="group" aria-label="Awards and bonuses">
            <IconToggle icon="road" label="Longest Road" points={2} checked={hasLongest} readOnly size={28} />
            {expansions.tb && (
              <IconToggle icon="anchor" label="Harbormaster" points={2} checked={hasHarborMaster} readOnly size={28} />
            )}
            {others.map(([key,label,pts,icon])=> (
              <IconToggle key={key} icon={icon} label={label} points={pts} checked={player[key]} onChange={v=>onChange(key, v)} size={28} />
            ))}
          </div>
          {metros.length > 0 && (
            <div className="mt-1 mb-2 flex flex-wrap justify-center gap-3 md:gap-4 w-full" role="group" aria-label="Metropolises">
              {metros.map(([key,label,pts,icon])=> (
                <IconToggle key={key} icon={icon} label={label} points={pts} checked={player[key]} onChange={v=>onChange(key, v)} size={28} />
              ))}
            </div>
          )}

          <div className="overflow-y-auto">
            <Counter icon="cards" label="Victory Cards" value={player.vpCards} onChange={v=>onChange('vpCards', v)} compact={compact} />
            <Counter icon="road" label="Roads" value={player.roads} onChange={v=>onChange('roads', v)} compact={compact} />
            {expansions.tb && (
              <>
                <Counter icon="anchor" label="Harbors" value={player.harbors} onChange={v=>onChange('harbors', v)} compact={compact} />
                <Counter icon="coin" label="Gold" value={player.gold} onChange={v=>onChange('gold', v)} compact={compact}
                  labelClassName={goldRank==='most' ? 'text-green-700 font-bold' : (goldRank==='least' ? 'text-red-700 font-bold' : undefined)} />
              </>
            )}
            {expansions.seafarers && (
              <Counter icon="island" label="Islands" value={player.islands} onChange={v=>onChange('islands', v)} compact={compact} />
            )}
            <Counter icon="settlement" label="Settlements" value={player.settlements} onChange={v=>onChange('settlements', v)} compact={compact} />
            <Counter icon="city" label="Cities" value={player.cities} onChange={v=>onChange('cities', v)} compact={compact} />
          </div>
        </section>
      );
    }

    const computeScore = (p, exp, bonus, hasLongest, hasHarborMaster)=>{
      const base = TOGGLES_ALL.filter(([, , , , show])=>show(exp)).reduce((s,[key, , pts])=> s + (p[key]? pts:0), 0);
      return base + (hasLongest?2:0) + ((exp.tb && hasHarborMaster)?2:0) + p.vpCards + (exp.seafarers? p.islands*2:0) + p.settlements + p.cities*2 + (exp.tb? bonus:0);
    };

    function App(){
      const mode = 'v3';
      const [players, setPlayers] = useState(()=>{
        try{
          const raw = localStorage.getItem('catan.players.v3');
          if(raw){ const parsed = JSON.parse(raw); if(Array.isArray(parsed) && parsed.length){ return parsed.map((p,i)=> ({...DEFAULT_PLAYER(i), ...p})); } }
        }catch(_){}
        return Array(4).fill().map((_,i)=>DEFAULT_PLAYER(i));
      });

      const [expansions, setExpansions] = useState(()=>{
        try{
          const raw = localStorage.getItem('catan.expansions.v2');
          if(raw){ const e = JSON.parse(raw); return { ck: !!e.ck, seafarers: !!e.seafarers, tb: !!e.tb }; }
        }catch(_){}
        return { ck:false, seafarers:false, tb:false };
      });

      useEffect(()=>{ try{ localStorage.setItem('catan.players.v3', JSON.stringify(players)); }catch(_){ } }, [players]);
      useEffect(()=>{ try{ localStorage.setItem('catan.expansions.v2', JSON.stringify(expansions)); }catch(_){ } }, [expansions]);

      const updatePlayer = useCallback((idx, field, value)=>{
        setPlayers(prev => prev.map((p,i)=>{
          if(i !== idx){
            if(value === true && EXCLUSIVE_KEYS.includes(field)) return { ...p, [field]: false };
            return p;
          }
          let next = { ...p };
          const NUM_FIELDS = new Set(['vpCards','gold','harbors','roads','islands','settlements','cities']);
          if(NUM_FIELDS.has(field)){
            const n = Math.max(0, Math.floor(Number(value)||0));
            value = n;
          }
          if(field === 'cities'){
            const prevCities = p.cities|0;
            const nextCities = Math.max(0, Number(value)||0);
            if(nextCities > prevCities){
              const delta = nextCities - prevCities;
              next.settlements = Math.max(0, p.settlements - delta);
            } else if(nextCities < prevCities){
              const delta = prevCities - nextCities;
              next.settlements = p.settlements + delta;
            }
            next.cities = nextCities;
          } else {
            next[field] = value;
          }
          return next;
        }));
      }, []);

      const addPlayer    = ()=> setPlayers(ps=>[...ps, DEFAULT_PLAYER(ps.length)]);
      const removePlayer = ()=> setPlayers(ps=> ps.length>1 ? ps.slice(0,-1) : ps);
      const resetAll     = ()=> setPlayers(Array(4).fill().map((_,i)=>DEFAULT_PLAYER(i)));
      const resetScores  = ()=> setPlayers(ps=> ps.map((p,i)=> ({
        ...p,
        longestRoad:false,
        harborMaster:false,
        metropolisScience:false,
        metropolisTrade:false,
        metropolisPolitics:false,
        merchant:false,
        vpCards:0,
        gold:0,
        harbors:0,
        roads:0,
        islands:0,
        settlements:1,
        cities:1
      })));
      const clearSave    = ()=> { localStorage.removeItem('catan.players.v3'); localStorage.removeItem('catan.expansions.v2'); resetAll(); setExpansions({ck:false,seafarers:false,tb:false}); };

      const goldBonuses = useMemo(()=> expansions.tb ? computeGoldBonuses(players) : players.map(()=>0), [players, expansions.tb]);
      const LONGEST_ROAD_THRESHOLD = 5;

      const roadCounts = useMemo(()=> players.map((p,i)=> ({ i, v: Math.max(0, Math.floor(Number(p.roads)||0)) })), [players]);
      const lrHolderRef = useRef(-1);
      const lrHolder = useMemo(()=>{
        if(!roadCounts.length) { lrHolderRef.current = -1; return -1; }
        const max = Math.max(...roadCounts.map(r=>r.v));
        if(max < LONGEST_ROAD_THRESHOLD) { lrHolderRef.current = -1; return -1; }
        const tops = roadCounts.filter(r=> r.v === max).map(r=> r.i);
        let holder = -1;
        if(tops.length === 1) holder = tops[0];
        else if(tops.includes(lrHolderRef.current)) holder = lrHolderRef.current;
        lrHolderRef.current = holder;
        return holder;
      }, [roadCounts]);
      const golds = useMemo(() => players.map(p=> p.gold), [players]);

      const harborCounts = useMemo(()=> players.map((p,i)=> ({ i, v: Math.max(0, Math.floor(Number(p.harbors)||0)) })), [players]);
      const hbHolderRef = useRef(-1);
      const hbIndex = useMemo(()=>{
        if(!expansions.tb) { hbHolderRef.current = -1; return -1; }
        if(!harborCounts.length) { hbHolderRef.current = -1; return -1; }
        const max = Math.max(...harborCounts.map(h=>h.v));
        if(max < 3) { hbHolderRef.current = -1; return -1; }
        const tops = harborCounts.filter(h=> h.v === max).map(h=> h.i);
        let holder = -1;
        if(tops.length === 1) holder = tops[0];
        else if(tops.includes(hbHolderRef.current)) holder = hbHolderRef.current;
        hbHolderRef.current = holder;
        return holder;
      }, [harborCounts, expansions.tb]);

      const scores = useMemo(()=> players.map((p,i)=> computeScore(p, expansions, (goldBonuses[i]||0), i===lrHolder, i===hbIndex)), [players, expansions, goldBonuses, lrHolder, hbIndex]);
      const bestScore = useMemo(()=> Math.max(0, ...scores), [scores]);
      const maxGold = useMemo(()=> golds.length ? Math.max(...golds) : 0, [golds]);
      const minGold = useMemo(()=> golds.length ? Math.min(...golds) : 0, [golds]);

      const [isFs, setIsFs] = useState(!!document.fullscreenElement);
      useEffect(()=>{ const onFs = ()=> setIsFs(!!document.fullscreenElement); document.addEventListener('fullscreenchange', onFs); return ()=> document.removeEventListener('fullscreenchange', onFs); }, []);
      const toggleFullscreen = ()=>{ if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.(); } else { document.exitFullscreen?.(); } };

      const toggleExp = (key)=> setExpansions(e=>({ ...e, [key]: !e[key] }));

      const totalCities = useMemo(()=>players.reduce((s,p)=>s+p.cities,0), [players]);

      return (
        <div className="h-full flex flex-col">
          <div className="flex-1 flex flex-col mx-auto w-full p-3 lg:p-4">
            <header className="mb-3">
              <h1 className="text-5xl text-red-800 text-center">Catan Score Tracker</h1>
              <div className="flex justify-center items-center mt-2 gap-3 flex-wrap">
                <button onClick={removePlayer} className="ghost-btn">‚Äì Player</button>
                <span className="text-lg font-semibold">{players.length} Players</span>
                <button onClick={addPlayer} className="ghost-btn">+ Player</button>
                <button className="fs-btn" onClick={toggleFullscreen}>{isFs ? 'Exit Fullscreen' : 'Fullscreen'}</button>
                <button className="ghost-btn" onClick={resetScores} title="Reset scoring (keep names & players)">Reset Scores</button>
                <button className="ghost-btn" onClick={clearSave} title="Clear saved game">Clear Save</button>
                <button className="ghost-btn" onClick={resetAll} title="Reset to 4 empty players">Reset All</button>
              </div>
              <div className="mt-3 flex items-center justify-center gap-2 flex-wrap">
                <span className="text-sm font-semibold text-gray-800 mr-1">Expansions:</span>
                <button onClick={()=>toggleExp('ck')} className={`pill ${expansions.ck ? 'bg-yellow-500 text-white shadow' : 'bg-black/10 text-gray-800 hover:bg-black/20'}`}>Cities & Knights</button>
                <button onClick={()=>toggleExp('seafarers')} className={`pill ${expansions.seafarers ? 'bg-yellow-500 text-white shadow' : 'bg-black/10 text-gray-800 hover:bg-black/20'}`}>Seafarers</button>
                <button onClick={()=>toggleExp('tb')} className={`pill ${expansions.tb ? 'bg-yellow-500 text-white shadow' : 'bg-black/10 text-gray-800 hover:bg-black/20'}`}>Traders & Barbarians</button>
              </div>
              <div className="mt-3 w-full flex justify-center">
                <div className="panel rounded-lg px-3 py-2 bg-yellow-200 shadow-md max-w-xs">
                  <div className="text-lg font-semibold text-gray-800 flex items-center justify-center gap-2">
                    <Icon name="city" />
                    <span>Total Cities:</span>
                    <span className="text-xl font-extrabold text-gray-900">{totalCities}</span>
                  </div>
                </div>
              </div>
            </header>
            <main className="flex-1 overflow-auto">
              <div className="flex flex-wrap justify-center gap-3 xl:gap-4 pt-2">
                {players.map((p,i)=> (
                  <div key={i} className="basis-full sm:basis-[calc(50%-0.75rem)] md:basis-[calc(25%-0.75rem)] xl:basis-[calc(25%-1rem)]">
                    <PlayerPanel
                      player={p}
                      expansions={expansions}
                      goldBonus={goldBonuses[i]||0}
                      hasLongest={i===lrHolder}
                      hasHarborMaster={i===hbIndex}
                      isLeader={scores[i] === bestScore}
                      goldRank={(p.gold===maxGold ? 'most' : (p.gold===minGold ? 'least' : 'mid'))}
                      mode={mode}
                      onChange={(f,v)=>updatePlayer(i,f,v)}
                    />
                  </div>
                ))}
              </div>
            </main>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
